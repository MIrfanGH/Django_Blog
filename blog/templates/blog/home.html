{% extends "blog/base.html" %}
{% block content %}

{% for post in posts %}
<article class="media content-section" id="post-{{ post.id }}"> 

    <!-- Author image -->
    <img class="rounded-circle article-img"
         src="{{ post.author.profile.image.url }}"
         alt="{{ post.author }}">

    <div class="media-body">

        <!-- Metadata -->
        <div class="article-metadata">
            <a class="mr-2"
               href="{% url 'same_user_posts' post.author.username %}">
               {{ post.author }}
            </a>
            <small class="text-muted">
                {{ post.date_posted|date:"F d, Y" }}
            </small>
        </div>

        <!-- Title -->
        <h2>
            <a class="article-title"
               href="{% url 'post_detail' post.id %}">
               {{ post.title }}
            </a>
        </h2>


<!-- >>>>>>>>>>>>>>>>>>>>>>>>> Summary Handling <<<<<<<<<<<<<<<<<<<<<<<<<< -->

        <form method="post" action="{% url 'summarize_post' post.id %}">
            {% csrf_token %}
            <button class="btn btn-sm btn-outline-primary">
                Summarize with AI
            </button>
        </form>
        {% if ai_summary and ai_summary.post_id == post.id %}
            <div class="ai-summary">
                <strong>AI Summary</strong>
                <p>{{ ai_summary.summary }}</p>
            </div>
        {% endif %}

        <p class="article-content">
            {{ post.content|truncatewords:40 }} 
            <a class="full-blog"
               href="{% url 'post_detail' post.id %}">Read full
               
            </a>
            
        </p>

    </div> 
</article>
{% endfor %}


<!-- >>>>>>>>>>>>>>>>>>>>>>>>>  Pagination  <<<<<<<<<<<<<<<<<<<<<<<<<< -->
{% if is_paginated %}
<div class="text-center">

    {% if page_obj.has_previous %}
        <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a class="btn btn-outline-info mb-4"
           href="?page={{ page_obj.paginator.num_pages }}">
           Last
        </a>
    {% endif %}

</div>
{% endif %}

{% endblock %}


